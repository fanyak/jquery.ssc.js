/*!
 * Social Shared Count - jQuery plugin
 * Author: KUCKLU ( VisuAlive )
 * Created date: 11.27.2014
 * Updated date: 11.27.2014
 * Version: 1.0.0
 * Licensed under the MIT license or GNU General Public License v2
 */
!function(t,e,s,n){"use strict";function i(t){var e=parseInt(t,10);return null===e?0:e>=1e9?(e/1e9).toFixed(1).replace(/\.0$/,"")+"G":e>=1e6?(e/1e6).toFixed(1).replace(/\.0$/,"")+"M":e>=1e3?(e/1e3).toFixed(1).replace(/\.0$/,"")+"K":e}var a,l={facebook:!1,twitter:!1,google:!1,pocket:!1,hatena:!1,twitterVia:null,twitterRelated:null};return a=function(e,s){return{init:function(){this.settings=t.extend({},l,s),this.triggerHolder=e,this.$container=t(e),this.$url=t(e).attr("data-ssc-url"),this.$title=t(e).attr("data-ssc-title"),this.sns={facebook:{name:"Facebook",url:"https://www.facebook.com/sharer/sharer.php?t="+encodeURIComponent(this.$title)+"&u="+encodeURIComponent(this._sanitizeUrl(this.$url))},twitter:{name:"Twitter",url:"https://twitter.com/intent/tweet?text="+encodeURIComponent(this.$title)+"&url="+encodeURIComponent(this._sanitizeUrl(this.$url))+this._sanitizeText(this.settings.twitterVia,"via")+this._sanitizeText(this.settings.twitterRelated,"related")},google:{name:"Google+",url:"https://plus.google.com/share?hl="+encodeURIComponent(this.$title)+"&url="+encodeURIComponent(this._sanitizeUrl(this.$url))},pocket:{name:"Pocket",url:"https://getpocket.com/save?title="+encodeURIComponent(this.$title)+"&url="+encodeURIComponent(this._sanitizeUrl(this.$url))},hatena:{name:"Hatena",url:"http://b.hatena.ne.jp/append?"+encodeURIComponent(this._sanitizeUrl(this.$url))}},this.listClass=String(this.triggerHolder.className)+"_list",this.listItemClass=String(this.listClass)+"_items",this.anchorClass=String(this.listItemClass)+"_anchor",this.snsNameClass=String(this.listItemClass)+"_name",this.countClass=String(this.listItemClass)+"_count",this.$url&&null!==this._sanitizeUrl(this.$url)&&this.$title&&(this._createCountBox(),this.settings.facebook===!0&&this._facebook(),this.settings.twitter===!0&&this._twitter(),this.settings.google===!0&&this._google(),this.settings.pocket===!0&&this._pocket(),this.settings.hatena===!0&&this._hatena())},_sanitizeHtml:function(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},_sanitizeText:function(t,e){if(t!==n&&null!==t){var s=t.match(/^[\w]+$/i);return"via"===e?null!==s?"&via="+encodeURIComponent(s[0]):"":"related"===e?null!==s?"&related="+encodeURIComponent(s[0]):"":null!==s?s[0]:""}return""},_sanitizeUrl:function(t){if(t!==n&&null!==t){var e=t.match(/^https?:\/\/[-_.!~*\'()a-zA-Z0-9;\/?:\@&=+\$,%#]+$/i);return null!==e?e[0]:null}return""},_createCountBox:function(){var t=this.$container;t.append('<ul class="'+String(this.listClass)+'" />');for(var e in this.sns)this.settings[e]===!0&&t.children("."+String(this.listClass)).append('<li class="'+String(this.listItemClass)+"-"+e+'" />').end().children("."+String(this.listClass)).children("."+String(this.listItemClass)+"-"+e).append('<a class="'+String(this.anchorClass)+'" href="'+this.sns[e].url+'" target="_blank" />').end().children("."+String(this.listItemClass)+"-"+e).children("."+String(this.anchorClass)).append('<span class="'+String(this.snsNameClass)+'" />').append('<span class="'+String(this.countClass)+'">0</span>').end().find("."+String(this.snsNameClass)).text(this._sanitizeHtml(this.sns[e].name))},_countElements:function(t){var e=this.$container;return e.children("."+String(this.listClass)).children("."+String(this.listItemClass)+"-"+t).find("."+String(this.countClass))},_facebook:function(){var e=this._countElements("facebook");t.ajax({type:"GET",dataType:"jsonp",url:"https://api.facebook.com/method/links.getStats?callback=?",data:{urls:this.$url,format:"json"},success:function(t){var s=i(t[0].share_count);e.text(s)},error:function(){e.text(0)}})},_twitter:function(){var e=this._countElements("twitter");t.ajax({type:"GET",dataType:"jsonp",url:"http://urls.api.twitter.com/1/urls/count.json?callback=?",data:{url:this.$url},success:function(t){var s=i(t.count);e.text(s)},error:function(){e.text(0)}})},_google:function(){var e=this._countElements("google");t.ajax({type:"GET",dataType:"xml",url:"http://query.yahooapis.com/v1/public/yql",data:{q:"SELECT content FROM data.headers WHERE url='https://plusone.google.com/_/+1/fastbutton?hl=ja&url="+this.$url+"' and ua='#Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/33.0.1750.154 Safari/537.36'",format:"xml",env:"http://datatables.org/alltables.env"},success:function(s){var n=t(s).find("content").text(),a=n.match(/window\.__SSR[\s*]=[\s*]{c:[\s*](\d+)/i),l=null!==a?i(a[1]):0;e.text(l)},error:function(){e.text(0)}})},_pocket:function(){var e=this._countElements("pocket");t.ajax({type:"GET",dataType:"xml",url:"http://query.yahooapis.com/v1/public/yql",data:{q:"SELECT content FROM data.headers WHERE url='https://widgets.getpocket.com/v1/button?label=pocket&count=horizontal&v=1&url="+this.$url+"' and ua='#Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/33.0.1750.154 Safari/537.36'",format:"xml",env:"http://datatables.org/alltables.env"},success:function(s){var n=t(s).find("content").text(),a=n.match(/<em\sid=\"cnt\">([0-9]+)<\/em>/i),l=null!==a?i(a[1]):0;e.text(l)},error:function(){e.text(0)}})},_hatena:function(){var e=this._countElements("hatena");t.ajax({type:"GET",dataType:"jsonp",url:"http://api.b.st-hatena.com/entry.count?callback=?",data:{url:this.$url},success:function(t){var s=i(t);e.text(s)},error:function(){e.text(0)}})}}},a.defaults=l,t.fn.socialSharedCount=function(t){return this.each(function(){new a(this,t).init()})},a}(jQuery,window,document);